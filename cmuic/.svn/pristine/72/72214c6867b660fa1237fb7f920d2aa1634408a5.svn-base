<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<link rel="stylesheet" type="text/css" href="css/iconfont.css" />
		<style type="text/css">
			.mui-bar-nav {
				border: none;
			}
			.mui-content{
				width: 100%;
				padding: 0;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<!--<h1 class="mui-title">마이페이지</h1>-->
			<a class="mui-icon mui-pull-right icon-chat" id="chatbt"></a>
			<!--icon-chat chat-news-->
		</header>
		<div class="barshadow"></div>
		<div class="mui-content personal-con" id="refreshContainer">
			<div class="personalhead">
				<dl>
					<dt><img :src="user.imgPath" width="90"/>
							<img :src="user.divisionImg" class="levein"/>
					</dt>
					<dd>
						<div class="pstitle">{{user.username}}
							<span v-if="2==user.sex" class="iconfont icon-women"></span>
							<span v-else class="iconfont icon-men"></span>
						</div>
						<p>Phone <span id="phonenum">{{user.phone}}</span></p>
						<p>Uid <span id="uidnum">{{user.uid}}</span></p>
					</dd>
				</dl>
			</div>
			<div class="coinnum">
				<div class="coinview"><span>{{user.todayAmount}}</span><br />금일 수익</div>
				<div class="coinview"><span>{{user.walletsAmount}}</span><br />지갑 잔여량</div>
			</div>
			<div class="cashxx">
				<div class="cashxx-view" id="mywallet">
					<img src="images/icon-cash.png" />
					<div class="view-con">
						<span>나의 지갑</span>

					</div>
				</div>
				<div class="cashxx-view" id="myreferrals">
					<img src="images/icon-xx.png" />
					<div class="view-con">
						<div class="xxnum">{{user.downCount}}</div>
						<span>나의 친구</span>
					</div>

				</div>
			</div>
			<div class="pslist">
				<ul class="mui-table-view">
					<li class="mui-table-view-cell" id="myinformationbtn">
						<a class="mui-navigate-right"><span class="iconfont icon-mypersent">기본 정보</span></a>
					</li>
					<li class="mui-table-view-cell" id="levelpagebtn">
						<a class="mui-navigate-right"><span class="iconfont icon-level">나의 레벨       </span>
							<div class="leveimg"><img :src="user.divisionImg" width="20"/>{{user.divisionName}}</div>
						</a>

					</li>
					<li class="mui-table-view-cell" id="shareDownLine">
						<a class="mui-navigate-right"><span class="iconfont icon-Invitation">친구 초대</span></a>
					</li>
					<li class="mui-table-view-cell " id="businesspagebtn">
						<a class="mui-navigate-right"><span class="iconfont icon-message">비지 니스</span></a>
					</li>
					<li class="mui-table-view-cell" id="aboutpagebtn">
						<a class="mui-navigate-right"><span class="iconfont icon-candy">회사 정보</span></a>
					</li>
				</ul>
			</div>
		</div>
		<script src="js/mui.min.js"></script>
		<script src="js/app.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/vue.min.js" type="text/javascript"></script>
		<script type="text/javascript">
			(function($, doc) {
				$.init({});
				$.plusReady(function() {
					var mywalletButton = doc.getElementById("mywallet");
					var myreferrals = doc.getElementById("myreferrals");

					mywalletButton.addEventListener('tap', function(event) {
						$.openWindow({
							url: 'wallet.html',
							id: 'wallet',
							show: {
								aniShow: 'pop-in'
							},
							styles: {
								popGesture: 'hide'
							},
							createNew: true,
							waiting: {
								autoShow: true
							},
							extras: {},
						});
					}, false);
					myreferrals.addEventListener('tap', function(event) {
						$.openWindow({
							url: 'referrals.html',
							id: 'referrals',
							preload: true,
							show: {
								aniShow: 'pop-in'
							},
							styles: {
								popGesture: 'hide'
							},
							waiting: {
								autoShow: true
							},
							extras: {},
						});
					}, false);
					doc.getElementById('myinformationbtn').addEventListener('tap', function() {
						$.openWindow({
							url: 'information.html',
							id: 'information',
							show: {
								aniShow: 'pop-in'
							},
							waiting: {
								autoShow: true
							},
							extras: {},
						});

					}, false);
					doc.getElementById('levelpagebtn').addEventListener('tap', function() {
						$.openWindow({
							url: 'level.html',
							id: 'level',
							show: {
								aniShow: 'pop-in'
							},
							styles: {
								popGesture: 'hide'
							},
							waiting: {
								autoShow: true
							},
							extras: {},
						});
					}, false);
					doc.getElementById('shareDownLine').addEventListener('tap', function() {
						$.openWindow({
							url: 'share.html',
							id: 'share',
							show: {
								aniShow: 'pop-in'
							},
							styles: {
								popGesture: 'hide'
							},
							waiting: {
								autoShow: true
							},
							extras: {},
						});
					}, false);
					doc.getElementById('businesspagebtn').addEventListener('tap', function() {
						$.openWindow({
							url: 'business.html',
							id: 'business',
							show: {
								aniShow: 'pop-in'
							},
							styles: {
								popGesture: 'hide'
							},
							waiting: {
								autoShow: true
							},
							extras: {},
						});
					}, false);
					doc.getElementById('aboutpagebtn').addEventListener('tap', function() {
						$.openWindow({
							url: 'aboutus.html',
							id: 'aboutus',
							preload: true,
							show: {
								aniShow: 'pop-in'
							},
							styles: {
								popGesture: 'hide'
							},
							waiting: {
								autoShow: true
							},
							extras: {},
						});
					}, false);

				})

				function getDefaultData() {
					return {
						user: {
							sex: 1,
							imgPath: '',
							username: '',
							uid: '',
							phone: '',
							walletsAmount: '0',
							todayAmount: '0',
							downCount: 0,
							divisionId: 1,
						}
					}
				}

				var userObj = new Vue({
					el: '.mui-content',
					data: getDefaultData(),
					methods: {
						resetData: function() { //重置数据
							Object.assign(this.$data, getDefaultData());
						}

					}
				});

				function validLogin() {
					if(app.getAuth() && null != app.getAuth()) {
						return true;
					}
					return false;
				}

				if(validLogin()) {
					initPersionData();
				}

				function initPersionData() {
					$.getJSON(app.serverApi(app.apiConstant.getPersionInfo), {}, function(res) {
						app.respondingTo(res.code, function(code) {
							if(0 != code) {
								plus.nativeUI.toast(res.msg);
							} else {
								var json = {};
								var imgDomain = res.data.imgDomain;
								var user = res.data.user;
								var walletsAmount = res.data.walletsAmount;
								var todayAmount = res.data.todayAmount;
								json.sex = user.sex;
								json.username = user.username;
								json.uid = user._id;
								json.phone = user.phone;
								json.walletsAmount = walletsAmount;
								if(json.walletsAmount && json.walletsAmount != null) {
									json.walletsAmount = app.getJoinAmount(json.walletsAmount);
								}
								json.todayAmount = todayAmount;
								if(imgDomain && user.photo && null != user.photo) {
									json.imgPath = imgDomain + substrAvatar(user.photo);
								} else {
									json.imgPath = "./images/man_1.jpg";
								}
								app.setSelfAvatar(json.imgPath);
								json.downCount = res.data.downCount;
								json.divisionId = 1;;
								if(res.data.divisionId) json.divisionId = res.data.divisionId;
								json.divisionName ="";
								if(res.data.divisionName){
									json.divisionName =res.data.divisionName;
								}
								json.divisionImg = "images/level-0" + json.divisionId + ".png";

								userObj.user = json;

							}
						})

					})
				}

				function substrAvatar(str) {
					var selfDir = "./images/";
					var unobj = "/active/image/avatar/";
					if(str.indexOf(unobj) > 0) {
						return selfDir + str.substr(str.indexOf(unobj) + n.length)
					}
					return str;
				}

				window.addEventListener('imgPath', function(e) {
					userObj.user.imgPath = e.detail.imgPath;
				})

				window.addEventListener('fresh', function(e) {
					initPersionData();
				});

				window.addEventListener("fpers", function() {
					if(validLogin()) {
						initPersionData();
					}
				})

				document.getElementById("chatbt").addEventListener('tap', function() {
					mui.openWindow({
						url: 'chat.html',
						id: 'chat',
						show: {
							aniShow: 'pop-in'
						},
						styles: {
							popGesture: 'close'
						},
						waiting: {
							autoShow: true
						},
					});
				})

			}(mui, document));
		</script>
	</body>

</html>