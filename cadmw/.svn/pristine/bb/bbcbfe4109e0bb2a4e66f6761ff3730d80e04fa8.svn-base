<#import "/spring.ftl" as spring /> <#import
"/admin/layouts/common.xhtml" as layout>
<@layout.title>用户任务进度</@layout.title> <@layout.metaKeywordsDescription>

</@layout.metaKeywordsDescription> <@layout.cssLink>
 </@layout.cssLink>
<@layout.pageHeader> 用户任务进度 </@layout.pageHeader> <@layout.mainContent>
	<input type="hidden" id="nav_id" value="userTask" />
<div class="well well-sm">
	<div class="row">
			<FORM action="/admin/userTasks.xhtml">

			<div class="col-sm-2">
				<input class="form-control" id="uid" name="uid" value="${(uid)!}" placeholder="用户ID" />
			</div>

			<div class="col-sm-2">
				<input class="form-control" id="taskId" name="taskId" value="${(taskId)!}" placeholder="任务ID" />
			</div>

			<div class="col-sm-2 form-group form-inline">
			<LABEL>状态:</LABEL>
				<select class="form-control" id="status" name="status">
					<option value="0">全部</option>
					<option value="-1" <#if status?? && status==-1>selected</#if>
						>审核失败</option>
					<option value="1" <#if status?? && status==1>selected</#if>
						>可做任务</option>
					<option value="2" <#if status?? && status==2>selected</#if>
						>进行中</option>
					<option value="3" <#if status?? && status==3>selected</#if>
						>待审审</option>
					<option value="4" <#if status?? && status==4>selected</#if>
						>已完成</option>
				</select>
		</div>

			<div class="col-sm-2">
				<button type="submit" class="btn btn-default">查询</button>
			</div>
		</FORM>
	</div>
</div>
<div class="row">
	<div class="col-lg-12">
		<div class="dataTable_wrapper">
			<table class="table table-striped table-bordered table-hover"
				id="dataTables-example">
				<thead>
					<tr>
						<th>用户ID</th>
						<th>任务ID</th>
						<th>当前进度</th>
						<th>状态</th>
						<th>图片</th>
						<th>操作</th>
					</tr>
				</thead>
				<tbody>
					<#list page.list as it>
					<tr class="gradeA">
						<td><a href="/admin/users.xhtml?userId=${(it.uid)!}" target="_black">${(it.uid)!}</a>
						</td>
						<td><a href="/admin/tasks.xhtml?_id=${(it.taskId)!}" target="_black">${(it.taskId)!}</a>
						</td>	
						<td class="center">
							${(it.plan)!}/${(it.total)!}
						</td>
						<td class="center">
							<#if it.status?? && it.status==6 >奖励已领取
							<#elseif it.status?? && it.status==4>完成
							<#elseif it.status?? && it.status==3>待审核
							<#elseif it.status?? && it.status==2>进行中
							<#elseif it.status?? && it.status==1>可领取
							<#elseif it.status?? && it.status==-1>审核失败
							</#if></td>
						<td class="center">
							<#if it.pics??>
								<#list it.pics as pic>
									<img src="${imgDomain}${(pic)!}" width="120px" />
								</#list>
							</#if>
						</td>
						<td class="center">
							<#if it.status?? && it.status==3>
								<a href="#" class="btn btn-sm btn-default ok"
									data-id="${it._id}">通过</a>
								<a href="#" class="btn btn-sm btn-default fail"
									data-id="${it._id}">不通过</a>
							</#if>
						</td>
					</tr>
					</#list>
				</tbody>
			</table>
		</div>
		<div class="row">
			<div class="col-sm-4">
				<div class="dataTables_info" id="dataTables-example_info"
					role="status" aria-live="polite">当前
					${page.curPage}/${page.totalPage}页， 共${page.total}条</div>
			</div>
			<div class="col-sm-8"><@vpage cur=page.curPage
				total=page.totalPage url=page.url > ${vpage}</@vpage></div>
		</div>
	</div>

	<!-- /.col-lg-12 -->
</div>

</@layout.mainContent> 
<@layout.script>
<script type="text/javascript">
$(function() {
$(".ok").click(function() {
	var id = $(this).data("id");
	var $t = $(this);
	$.post("/admin/userTask", {
		id : id,
		status : 4
	}, function(ret) {
		if (ret.code != 0) {
			alert(ret.msg);
		} else {
			$t.parent().html("");
			alert("Success");
		}
	});
});

$(".fail").click(function() {
	var id = $(this).data("id");
	var $t = $(this);
	$.post("/admin/userTask", {
		id : id,
		status : -1
	}, function(ret) {
		if (ret.code != 0) {
			alert(ret.msg);
		} else {
			$t.parent().html("");
			alert("Success");
		}
	});
});
});
</script>
</@layout.script>

